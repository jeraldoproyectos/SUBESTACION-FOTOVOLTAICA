<!DOCTYPE html>
<html>
<head>
    <title>SUBESTACION FOTOVOLTAICA</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin: 0; padding: 0; background: #1a1a1a; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        #map { height: 100vh; width: 100%; cursor: crosshair; }
        
        .brand-logo {
            position: absolute; bottom: 20px; left: 20px; z-index: 2500;
            width: 150px; filter: drop-shadow(0 2px 5px rgba(0,0,0,0.7));
            pointer-events: none;
        }

        .ui-container {
            position: absolute; bottom: 25px; left: 50%; transform: translateX(-50%);
            width: 25%; min-width: 220px; z-index: 2000;
            display: flex; flex-direction: column; align-items: center; gap: 8px;
        }

        .utm-box {
            background: rgba(0,0,0,0.9); color: #00ff00; padding: 5px 12px;
            border-radius: 4px; border: 1px solid #444; font-family: monospace;
            font-size: 12.5px; font-weight: bold;
        }

        .slider-wrapper {
            background: rgba(0,0,0,0.9); padding: 9px 11px; border-radius: 6px;
            width: 100%; border: 1px solid #333; text-align: center;
        }

        .current-date-label { 
            display: inline-block; color: #00ff00; font-size: 9px; font-weight: bold;
            border: 1px solid #00ff00; padding: 1.5px 6px; border-radius: 3px;
            margin-bottom: 6px; background: rgba(0, 255, 0, 0.05);
        }

        .date-active { background: #00ff00 !important; color: #000 !important; }
        input[type=range] { width: 100%; cursor: pointer; accent-color: #00ff00; height: 3px; }
    </style>
</head>
<body>

<!-- Cuando tengas el logo final, reemplaza "logo.jpg" por la ruta correcta -->
<img src="logo.jpg" class="brand-logo" alt="Logo SUBESTACION FOTOVOLTAICA">

<div id="map"></div>

<div class="ui-container">
    <div class="utm-box" id="utm-coord">E: --- | N: ---</div>
    <div class="slider-wrapper">
        <div id="fecha-label" class="current-date-label">CARGANDO...</div>
        <input type="range" id="smooth-slider" min="0" value="0" step="1">
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.9.0/proj4.js"></script>

<script>
    // Proyecciones UTM 19S y WGS84
    var utm19S = "+proj=utm +zone=19 +south +datum=WGS84 +units=m +no_defs";
    var wgs84 = "+proj=longlat +datum=WGS84 +no_defs";

    // Mapa base
    var map = L.map('map', { zoomControl: false, minZoom: 18, maxZoom: 23 })
              .setView([-20.351387, -69.721985], 19);

    // Ortofoto base de Google (puedes cambiarla después si quieres usar solo tus ortofotos)
    L.tileLayer('https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
        maxZoom: 23
    }).addTo(map);

    // Pane para el plano (fundaciones)
    map.createPane('planoPane');
    map.getPane('planoPane').style.zIndex = 1000;
    map.getPane('planoPane').style.pointerEvents = 'none';

    // Coordenadas de la imagen de fundaciones (ajusta si cambias el plano)
    var imageBounds = [
        [-20.3519680745, -69.7226506296], // Sur-Oeste
        [-20.3506811321, -69.7212255524]  // Norte-Este
    ];

    // Plano de fundaciones (cuando tengas la imagen final, reemplaza 'fundaciones.png')
    L.imageOverlay('fundaciones.png', imageBounds, {
        pane: 'planoPane',
        opacity: 0.9,
        interactive: false
    }).addTo(map);

    // Coordenadas UTM bajo el mouse
    map.on('mousemove', function(e) {
        var p = proj4(wgs84, utm19S, [e.latlng.lng, e.latlng.lat]);
        document.getElementById('utm-coord').innerHTML =
            'E: ' + p[0].toFixed(2) + ' | N: ' + p[1].toFixed(2);
    });

    // Fechas de tus ortofotos (puedes editar estos textos)
    var fechas = ["03/12/2025", "09/01/2026", "21/01/2026", "23/01/2026", "28/01/2026"];

    // Capas raster tipo XYZ (ajusta las rutas cuando tengas las carpetas listas)
    var capas = [
        L.tileLayer('03122025/Z{z}/{y}/{x}.png', { maxZoom: 23, opacity: 1 }).addTo(map),
        L.tileLayer('09012026/Z{z}/{y}/{x}.png', { maxZoom: 23, opacity: 0 }).addTo(map),
        L.tileLayer('21012026/Z{z}/{y}/{x}.png', { maxZoom: 23, opacity: 0 }).addTo(map),
        L.tileLayer('23012026/Z{z}/{y}/{x}.png', { maxZoom: 23, opacity: 0 }).addTo(map),
        L.tileLayer('28012026/Z{z}/{y}/{x}.png', { maxZoom: 23, opacity: 0 }).addTo(map)
    ];

    // Slider para transición suave entre fechas
    var slider = document.getElementById('smooth-slider');
    var label = document.getElementById('fecha-label');
    slider.max = (capas.length - 1) * 100;

    function updateView() {
        var val = parseFloat(slider.value);
        var snappingPoint = Math.round(val / 100) * 100;
        if (Math.abs(val - snappingPoint) < 12) { val = snappingPoint; }

        var index = Math.floor(val / 100);
        var subVal = (val % 100) / 100;
        if (index >= capas.length - 1) { index = capas.length - 2; subVal = 1; }
        
        capas.forEach(function(c, i) {
            if (i === index) c.setOpacity(1 - subVal);
            else if (i === index + 1) c.setOpacity(subVal);
            else c.setOpacity(0);
        });
        
        var fechaActual = (subVal > 0.5) ? fechas[index + 1] : fechas[index];
        label.innerText = fechaActual;

        if (subVal === 0 || subVal === 1) label.classList.add('date-active');
        else label.classList.remove('date-active');
    }

    slider.addEventListener('input', updateView);
    slider.addEventListener('change', function() {
        this.value = Math.round(this.value / 100) * 100;
        updateView();
    });

    updateView();
</script>
</body>
</html>
